<!DOCTYPE html>
<?php 
	include_once 'valve.php'
?>
<html>
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	<title>Michaeli's PI Irrigation</title>
	<link href="css/style.css" rel="stylesheet" type="text/css" />
	<meta name="keywords" content="raspberry pi irrigation michaeli" />
	<meta name="description" content="Irrigation system status & control, by Ronen Michaeli 2013" />
</head>
<body>
	<header>
        <div class="logo">
			<h1>Michaeli's PI Irrigation system</h1>
            <a href="index.html"><img src="http://lorempixel.com/300/80/nature" alt="PI Irrigation Logo" /></a>
        </div>
    </header>    
    <div class="content">
		<?php if (isset($_GET["Valve"])) { ?>
			<?php $Valve = GetValvesList()[$_GET["Valve"]]; ?>
			<table class=center style="margin-top:10px; margin-bottom:0px"><tr>
				<td class=valve_image style=width:72px><img src="<?=$Valve->params['General']['Image']?>"/></td>
				<td style="vertical-align:middle; padding:0 10px 0 10px"><h1><?=$Valve->params['General']['Name']?></h1></td>
			</tr></table>
			<form action="" method="post" name="ValveConfig"><table style="width:100%; table-layout:fixed; margin:10px">
			<colgroup><col style="width:10%"></colgroup>
			<tr><td colspan=3><div class=center style="width:80%">
				<?php if ($Valve->IsOpen()) { ?>
					<input type="submit" name="Close" value="Close NOW" class=manual_closed style="width:100%;height:40px;font-size:20px">
				<?php } else { ?>
					<input type="submit" name="Open" value="Open NOW" class=manual_opened style="width:100%;height:40px;font-size:20px">
				<?php } ?>
				</div></td></tr>
			<tr><td colspan=2><div style="margin-top:10px; margin-bottom:0px">Use automatic scheduling?</div></td>
				<td><select name="Auto">
					<option value="1" <?php if ($Valve->params['Status']['Auto']) echo 'selected' ?> >Yes</option>
					<option value="0" <?php if (!$Valve->params['Status']['Auto']) echo 'selected' ?> >No</option>
				</select></td></tr>
			<tr><td></td>
				<td>Open at</td>
				<td><input type="time" name="AutoAt" value="<?=$Valve->FormatAutoTime()?>"></td></tr>
			<tr><td></td>
				<td>Days in between</td>
				<td><select name="AutoInterval">
					<?php for ($i=1;$i<=10;$i++) {
						echo "<option value=\"$i\"";
						if ($Valve->params['Auto']['Interval'] == "P{$i}D") { echo " selected"; }
						echo ">$i</option>";
					} ?>
				</select></td></tr>
			<tr><td></td>
				<td>Open for</td>
				<td><input type="time" name="AutoDuration" value="<?=$Valve->FormatAutoDuration()?>"></td></tr>
			<tr><td colspan=2><div style="margin-top:10px; margin-bottom:0px">Use manual scheduling?</div></td>
				<td><select name="Manual">
					<option value="1" <?php if ($Valve->params['Status']['Manual']) echo 'selected' ?> >Yes</option>
					<option value="0" <?php if (!$Valve->params['Status']['Manual']) echo 'selected' ?> >No</option>
				</select></td></tr>
			<tr><td></td>
				<td>Open at</td>
				<td><input type="date" name="ManualAtDate" value="<?=$Valve->FormatManualDate()?>">
					<input type="time" name="ManualAtTime" value="<?=$Valve->FormatManualTime()?>"></td></tr>
			<tr><td></td>
				<td>Open for</td>
				<td><input type="time" name="ManualDuration" value="<?=$Valve->FormatManualDuration()?>"></td></tr>
			<tr><td colspan=3>
				<div class=center style="width:40%;margin-top:10px">
					<input type="submit" name="Save" value="Save" class="status" style="width:100%;height:30px;font-size:16px">
				</div></td></tr>
			</table>
			</form>
		<?php } else { ?>
			<nav class="vertical menu">
				<ul>
					<?php foreach(GetValvesList() as $key=>$valve){?>
						<li><a href="index.html?Valve=<?=$key?>"><?php $valve->GenerateMainMenuItem() ?></a></li>
					<?php }?>
					<li><a href="basic_markup.html">Basic Markup</a></li>
					<li><a href="contact.html">Contact</a></li>
				</ul>
			</nav> 
			<small class="copy">Current time and date: <?=(new DateTime())->format(Valve::DATEFORMAT)?></small>
		<?php } ?>
    </div>
    <footer>
        <p class="copy">
		&copy; 2013 pi.micronen.mooo.com | All right reserved <br/>
		Design By Ronen Michaeli micronen@gmail.com <br/>
		Based on template by <a href="http://www.mobifreaks.com" title="Design By Mobifreaks.com">Mobifreaks.com</a><br/></p>
	</footer>
	GET:<br><?php print_r($_GET) ?><br>
	POST:<br><?php print_r($_POST) ?><br>
</body>
</html>
	