<!DOCTYPE html>
<?php 
	include_once 'valve.php'
?>
<html>
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	<title>Michaeli's PI Irrigation</title>
	<link href="css/style.css" rel="stylesheet" type="text/css" />
	<meta name="keywords" content="raspberry pi irrigation michaeli" />
	<meta name="description" content="Irrigation system status & control, by Ronen Michaeli 2013" />
</head>
<body>
	<header>
        <div class="logo">
			<h1>Michaeli's PI Irrigation system</h1>
            <a href="index.html"><img src="http://lorempixel.com/300/80/nature" alt="PI Irrigation Logo" /></a>
        </div>
    </header>    
    <div class="content">
		<?php
		$menu = true;
		if (isset($_GET["Valve"])) {
			$Valve = GetValvesList()[$_GET["Valve"]];
			if (isset($_POST["Open"])) {
				$Valve->ManualOpenNow();
			} elseif (isset($_POST["Close"])) {
				$Valve->DoClose();
			} elseif (isset($_POST["Save"])) {
				$Valve->UpdateParamsFromForm();
			} else { 
				$Valve->GenerateParamsForm();
				$menu = false;
			}
		}
		if ($menu) { ?>
			<nav class="vertical menu">
				<ul>
					<?php foreach(GetValvesList() as $key=>$valve){?>
						<li><a href="index.html?Valve=<?=$key?>"><?php $valve->GenerateMainMenuItem() ?></a></li>
					<?php }?>
					<li><a href="basic_markup.html">Basic Markup</a></li>
					<li><a href="contact.html">Contact</a></li>
				</ul>
			</nav> 
			<small class="copy">Current time and date: <?=(new DateTime())->format(Valve::DATEFORMAT)?></small>
		<?php } ?>
    </div>
    <footer>
        <p class="copy">
		&copy; 2013 pi.micronen.mooo.com | All right reserved <br/>
		Design By Ronen Michaeli micronen@gmail.com <br/>
		Based on template by <a href="http://www.mobifreaks.com" title="Mobifreaks.com">Mobifreaks.com</a><br/></p>
		<div>
		GET:<br><?php print_r($_GET) ?><br>
		POST:<br><?php print_r($_POST) ?><br>
		Valve:<br><?php print_r($Valve) ?><br>
		</div>
	</footer>
</body>
</html>
	